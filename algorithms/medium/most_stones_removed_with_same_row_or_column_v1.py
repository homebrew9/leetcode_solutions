#
# Kinda like Union Find... just went with the logic of "collecting" all points
# for each x and y coordinate.
#
from typing import List
from collections import defaultdict

class Solution:
    def removeStones(self, stones: List[List[int]]) -> int:
        def dfs(key, coordinate, components):
            if coordinate == 'x':
                for yc in xhsh[key]:
                    components.add((key, yc))
                self.visitedx.add(key)
                for yc in xhsh[key]:
                    if yc not in self.visitedy:
                        components = dfs(yc, 'y', components)
            elif coordinate == 'y':
                for xc in yhsh[key]:
                    components.add((xc, key))
                self.visitedy.add(key)
                for xc in yhsh[key]:
                    if xc not in self.visitedx:
                        components = dfs(xc, 'x', components)
            return components
            
        xhsh = defaultdict(list)
        yhsh = defaultdict(list)
        for x, y in stones:
            xhsh[x] += [y]
            yhsh[y] += [x]
        self.visitedx = set()
        self.visitedy = set()
        res = 0
        for k in xhsh:
            if k not in self.visitedx:
                components = set()
                components = dfs(k, 'x', components)
                res += len(components) - 1
        return res

# Main section
for stones in [
                 [[0,0],[0,1],[1,0],[1,2],[2,1],[2,2]],
                 [[0,0],[0,2],[1,1],[2,0],[2,2]],
                 [[0,0]],
                 [[0,0],[1,0],[0,1]],
                 [[0,0],[1,1]],
                 [[0,0],[1,1],[1,0]],
                 [[0,1],[4,10],[4,0],[7,7],[8,10],[5,1],[1,4],[3,0],[1,7],[4,7]],
                 [[1,95],[59,73],[94,76],[94,21],[55,59],[100,3],[15,96],[2,96],[40,34],[54,33],[43,69],[33,13],[18,58],[41,90],[18,12],[99,86],[1,99],[16,42],[66,46],[57,43],[12,84],[74,13],[18,51],[62,14],[20,8],[36,4],[36,68],[27,65],[34,25],[76,3],[38,50],[16,56],[4,36],[90,14],[41,39],[28,75],[80,21],[51,79],[13,71],[88,19],[41,96],[76,26],[88,28],[97,85],[41,80],[18,75],[29,81],[75,2],[38,47],[29,44],[96,9],[36,86],[10,67],[33,87],[51,40],[2,35],[9,59],[21,88],[7,61],[3,48],[29,12],[78,14],[35,43],[58,75],[4,19],[10,7],[96,77],[70,92],[94,22],[11,79],[29,60],[65,34],[14,59],[32,40],[78,7],[70,3],[87,19],[90,36],[43,58],[42,60],[3,34],[92,91],[17,97],[83,51],[10,66],[34,51],[21,51],[84,9],[38,21],[26,28],[43,44],[6,89],[70,7],[43,53],[87,87],[78,84],[54,84],[19,80],[35,79],[24,24]],
                 [[377,773],[158,177],[721,165],[221,791],[19,0],[837,376],[434,755],[49,288],[637,22],[752,9],[265,806],[81,896],[731,978],[786,410],[317,853],[31,221],[288,817],[446,82],[950,271],[829,866],[614,322],[857,946],[674,852],[811,94],[214,342],[952,308],[438,334],[413,588],[881,275],[836,752],[127,957],[410,900],[293,513],[566,272],[914,699],[866,384],[789,686],[343,200],[356,709],[636,327],[920,513],[697,859],[218,577],[962,110],[740,802],[369,508],[393,475],[692,762],[304,119],[825,388],[751,677],[617,359],[352,931],[484,95],[915,300],[704,89],[182,111],[445,85],[668,917],[924,101],[190,362],[940,64],[200,165],[919,944],[114,650],[86,817],[362,999],[808,173],[332,64],[289,93],[623,774],[552,76],[999,387],[44,927],[175,126],[150,191],[990,177],[159,685],[75,286],[333,810],[769,694],[985,974],[688,113],[8,354],[755,539],[291,157],[700,752],[440,545],[191,88],[388,364],[883,297],[763,152],[377,98],[169,972],[527,689],[978,296],[110,666],[336,829],[289,241],[815,418],[332,450],[956,165],[398,157],[876,285],[154,938],[823,50],[887,443],[830,336],[150,339],[504,422],[565,14],[171,371],[314,679],[755,916],[736,637],[496,814],[364,756],[233,858],[522,305],[320,588],[47,164],[15,379],[800,658],[560,188],[31,76],[986,943],[261,956],[150,460],[930,642],[321,836],[409,818],[789,285],[978,35],[115,847],[562,642],[629,412],[216,252],[569,281],[69,480],[461,428],[870,785],[327,110],[687,929],[36,541],[855,733],[983,662],[195,714],[773,35],[584,535],[455,134],[193,515],[143,923],[618,30],[789,397],[735,197],[335,208],[527,796],[332,548],[403,599],[785,274],[754,695],[227,135],[951,77],[850,501],[742,330],[946,218],[972,783],[287,680],[854,242],[829,307],[576,792],[334,383],[870,744],[823,4],[871,569],[41,148],[70,938],[235,907],[694,518],[16,73],[880,794],[318,115],[511,15],[768,95],[336,410],[467,512],[550,101],[686,550],[509,109],[504,3],[408,682],[555,225],[385,967],[749,328],[824,996],[483,465],[544,722],[514,53],[910,956],[175,596],[874,197],[837,724],[195,165],[576,540],[23,736],[165,402],[632,691],[964,783],[432,19],[229,423],[424,909],[579,38],[979,893],[661,327],[837,333],[743,415],[69,461],[473,801],[813,232],[362,543],[568,410],[109,799],[692,854],[126,177],[28,545],[294,417],[442,679],[963,512],[575,525],[27,738],[824,1000],[751,787],[57,190],[14,646],[928,819],[659,533],[762,140],[494,725],[850,518],[208,386],[530,913],[406,114],[624,175],[931,601],[213,83],[719,16],[404,517],[776,407],[588,774],[529,459],[135,392],[225,969],[285,318],[49,69],[332,677],[647,24],[589,190],[26,741],[618,235],[233,573],[36,553],[30,482],[488,790],[616,957],[33,911],[448,70],[821,432],[10,253],[856,975],[319,859],[494,711],[625,386],[911,362],[557,907],[518,31],[846,125],[278,836],[448,344],[582,662],[70,2],[773,815],[418,587],[242,114],[898,419],[594,416],[867,840],[813,869],[76,63],[59,267],[774,621],[470,368],[286,785],[703,817],[515,757],[874,290],[968,343],[532,935],[988,986],[159,848],[890,689],[936,140],[858,202],[913,803],[272,914],[925,539],[585,62],[215,779],[9,113],[870,850],[160,663],[2,891],[774,733],[426,819],[785,263],[668,343],[784,774],[924,659],[467,600],[449,137],[955,921],[334,583],[279,647],[484,33],[595,358],[851,55],[263,559],[912,977],[945,71],[821,310],[1,958],[742,166],[140,735],[353,452],[803,899],[824,693],[84,831],[193,463],[55,529],[813,702],[719,509],[633,744],[339,544],[475,414],[380,709],[782,58],[678,257],[126,418],[980,577],[150,623],[824,976],[145,50],[905,394],[669,19],[646,152],[559,422],[699,972],[558,704],[349,194],[928,148],[294,496],[798,295],[733,476],[605,785],[828,973],[176,815],[333,204],[460,156],[637,606],[321,626],[736,728],[134,4],[943,133],[42,177],[717,962],[395,17],[717,971],[297,296],[738,536],[490,434],[963,883],[167,177],[869,220],[115,237],[192,359],[802,139],[733,835],[795,908],[470,870],[877,718],[426,782],[894,798],[386,718],[458,496],[653,177],[419,10],[617,4],[129,595],[228,290],[188,254],[204,589],[127,476],[533,279],[663,883],[87,934],[903,208],[472,516],[886,137],[265,455],[660,347],[410,702],[289,403],[120,491],[275,514],[451,996],[187,639],[791,12],[453,282],[240,803],[653,545],[442,380],[465,256],[658,660],[852,373],[197,185],[330,68],[847,38],[776,652],[879,875],[883,598],[926,340],[865,321],[543,50],[505,423],[497,419],[558,676],[82,994],[589,691],[33,711],[678,85],[777,482],[868,511],[784,350],[802,673],[498,810],[249,353],[885,689],[716,642],[52,562],[768,24],[26,433],[651,342],[277,442],[672,563],[431,82],[198,396],[456,166],[763,830],[762,865],[818,101],[901,773],[427,368],[544,624],[165,875],[670,364],[513,646],[301,9],[773,880],[137,404],[821,124],[188,626],[487,108],[171,784],[637,461],[373,15],[156,673],[923,922],[502,7],[488,356],[51,229],[832,794],[980,818],[783,789],[140,832],[887,739],[4,5],[1000,140],[618,978],[613,216],[560,637],[34,271],[80,628],[944,352],[157,759],[315,540],[60,152],[494,115],[235,669],[658,870],[933,998],[865,702],[666,227],[548,253],[799,491],[916,271],[307,401],[242,192],[603,799],[493,21],[125,290],[204,156],[59,592],[845,997],[249,78],[720,81],[821,896],[591,592],[488,863],[30,137],[203,712],[332,844],[252,735],[819,572],[735,84],[784,614],[534,570],[430,202],[517,270],[319,276],[780,900],[801,38],[385,221],[378,838],[309,250],[639,214],[624,652],[72,386],[381,89],[128,574],[733,806],[202,96],[580,811],[470,185],[601,614],[10,429],[218,467],[997,861],[874,116],[121,562],[211,190],[154,321],[552,730],[459,548],[817,921],[433,648],[412,198],[868,60],[818,468],[794,120],[717,663],[458,323],[638,946],[393,441],[288,257],[229,607],[990,449],[675,28],[785,336],[547,117],[947,78],[72,790],[208,660],[200,558],[183,249],[205,106],[677,74],[671,808],[579,972],[816,808],[148,111],[148,547],[711,862],[470,665],[900,11],[759,310],[666,82],[154,981],[195,982],[350,200],[208,772],[396,743],[163,392],[493,694],[595,58],[528,633],[143,306],[953,13],[280,806],[62,983],[113,162],[17,841],[787,237],[851,667],[923,107],[60,784],[162,185],[949,406],[13,471],[462,297],[525,1000],[741,624],[976,527],[871,334],[436,662],[214,222],[477,196],[552,199],[14,533],[799,67],[579,82],[317,171],[476,582],[134,989],[354,894],[275,183],[674,179],[364,758],[890,78],[441,889],[744,234],[636,719],[611,406],[273,11],[69,361],[22,667],[107,464],[343,183],[616,332],[348,23],[573,361],[639,343],[738,703],[236,456],[245,196],[722,597],[137,105],[917,427],[358,967],[868,989],[540,867],[136,527],[158,802],[277,246],[175,473],[431,798],[787,1000],[740,412],[581,752],[733,373],[704,337],[668,500],[726,105],[745,347],[846,21],[678,28],[241,692],[87,872],[83,493],[127,679],[890,976],[982,156],[616,974],[875,569],[374,803],[657,90],[669,482],[634,888],[975,534],[24,708],[812,0],[621,42],[321,833],[324,164],[427,576],[730,196],[10,553],[592,253],[726,482],[688,617],[795,176],[289,880],[519,924],[731,951],[637,13],[284,649],[343,546],[173,534],[5,303],[158,15],[909,957],[876,780],[920,450],[324,47],[748,213],[752,85],[932,739],[151,631],[580,903],[83,106],[878,996],[663,25],[312,832],[167,514],[746,32],[243,961],[166,787],[495,935],[506,41],[278,404],[924,447],[464,310],[24,941],[494,323],[240,992],[995,98],[13,950],[553,796],[802,67],[842,908],[747,945],[102,640],[304,366],[63,11],[840,444],[380,352],[923,222],[400,419],[641,207],[35,824],[446,535],[279,129],[803,525],[461,267],[793,121],[610,265],[942,73],[120,657],[455,638],[736,889],[394,124],[303,104],[821,39],[418,329],[568,524],[207,127],[943,312],[341,643],[39,561],[555,87],[212,907],[721,775],[256,419],[387,341],[481,784],[544,822],[937,506],[522,404],[516,760],[438,670],[632,526],[597,187],[129,747],[82,913],[877,241],[544,669],[307,604],[419,418],[875,936],[85,98],[656,102],[988,566],[479,954],[893,850],[687,327],[852,660],[727,656],[979,782],[129,621],[816,904],[36,631],[845,373],[652,244],[190,698],[777,275],[327,29],[610,772],[937,901],[208,621],[307,743],[425,210],[850,1000],[937,739],[924,958],[53,338],[22,997],[905,963],[213,574],[630,606],[974,806],[14,108],[169,131],[280,493],[702,204],[291,731],[149,171],[806,23],[701,495],[166,727],[108,237],[503,421],[36,388],[343,387],[452,37],[976,43],[33,737],[947,254],[162,869],[986,520],[548,1],[776,134],[634,706],[171,289],[807,130],[132,477],[994,878],[466,493],[754,780],[197,179],[254,332],[492,649],[719,502],[223,326],[25,198],[27,954],[736,847],[488,117],[513,290],[190,841],[771,69],[565,727],[986,232],[591,349],[475,7],[200,226],[121,836],[464,919],[721,68],[790,567],[507,633],[924,0],[485,731],[416,622],[371,53],[911,830],[193,604],[37,702],[910,120],[44,85],[319,689],[479,400],[359,115],[83,171],[209,158],[545,772],[803,631],[12,129],[741,665],[365,405],[944,872],[350,789],[994,473],[13,786],[447,749],[222,374],[44,197],[410,821],[852,407],[245,772],[597,684],[939,286],[905,135],[393,378],[395,549],[739,359],[862,847],[66,239],[529,378],[43,902],[615,808],[247,827],[631,17],[187,785],[177,991],[985,518],[685,235],[213,932],[657,981],[685,6],[816,727],[527,197],[234,973],[519,620],[81,138],[850,311],[408,771],[368,317],[762,863],[821,522],[621,497],[780,243],[763,828],[822,258],[896,436],[661,533],[676,680],[870,545],[501,837],[710,929],[540,917],[194,280],[923,426],[147,168],[187,12],[885,561],[576,202],[207,893],[600,806],[676,307],[248,98],[51,874],[975,692],[484,393],[15,561],[770,570],[343,363],[640,631],[390,29],[935,256],[911,802],[287,202],[764,383],[480,862],[332,371],[54,772],[841,904],[891,496],[685,486],[648,598],[766,483],[522,370],[788,102],[70,716],[772,899],[677,500],[0,401],[647,221],[454,998],[746,343],[710,695],[667,733],[983,435],[621,348],[464,392],[189,187],[886,493],[82,61],[591,981],[994,310],[985,252],[295,708],[70,846],[302,716],[607,696],[535,537],[393,206],[318,450],[808,39],[714,697],[774,562],[560,639],[348,45],[674,66],[958,401],[516,523],[423,493],[581,262],[988,927],[321,622],[48,436]],
              ]:
    print(f'stones = {stones}')
    sol = Solution()
    r = sol.removeStones(stones)
    print(f'r = {r}')
    print('====================')

